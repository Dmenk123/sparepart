var save_method,table,id_pen;$(document).ready(function(){let a=new URL(window.location.href);bulanUri=a.searchParams.get("bulan"),tahunUri=a.searchParams.get("tahun"),kategoriUri=a.searchParams.get("kategori"),"add_penerimaan"==window.location.pathname.split("/")[4]&&(getTable(),getTotal()),$("input.numberinput").bind("keypress",function(a){return 8==a.which||0==a.which||!(a.which<48||57<a.which)||46==a.which}),table=$("#tabel_penerimaan").DataTable({responsive:!0,processing:!0,serverside:!0,ajax:{url:base_url+"bayar_hutang/list_bayar_hutang",type:"POST",data:{tahun:tahunUri,bulan:bulanUri,kategori:kategoriUri}},language:{decimal:",",thousands:"."},createdRow:function(a,e,t){"Lunas"==e[3]&&$(a).addClass("highlight_row_success")}}),$("#id_barang").on("select2:select",function(a){a=a.params.data;$.ajax({type:"get",url:base_url+"pembelian/get_harga_barang",data:{id_barang:a.id},dataType:"json",success:function(a){$("#hsat").val(a.hpp)}})}),$("#kode_pembelian").on("select2:select",function(a){a=a.params.data,a=String(parseFloat(a.title));console.log(a),$("#hutang_txt").val(formatRupiah(a)),$("#hutang").val(a)}),$(".modal").on("hidden.bs.modal",function(){}),$("#form_pembayaran").submit(function(a){a.preventDefault(),$("#btnSaveAdd").prop("disabled",!0),$("#btnSaveAdd").text("Menyimpan Data ....");var a=$("#form_pembayaran")[0],e=new FormData(a);swalConfirm.fire({title:"Perhatian",text:"Apakah Anda ingin Membayar Data ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!1}).then(a=>{a.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"bayar_hutang/simpan_pembayaran",data:e,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)swalConfirm.fire("Sukses!",a.pesan,"success"),$("#form_pembayaran")[0].reset(),window.location.href=base_url+"bayar_hutang";else{for(var e=0;e<a.inputerror.length;e++)"kode_pembelian"!=a.inputerror[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSaveAdd").prop("disabled",!1),$("#btnSaveAdd").text("Simpan")}},error:function(a){console.log("ERROR : ",a),createAlert("Opps!","Terjadi Kesalahan","Coba Lagi nanti","danger",!0,!1,"pageMessages"),$("#btnSaveAdd").prop("disabled",!1),$("#btnSaveAdd").text("Simpan")}}):a.dismiss===Swal.DismissReason.cancel&&(swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error"),$("#btnSaveAdd").prop("disabled",!1),$("#btnSaveAdd").text("Simpan"))})})});const detail_transaksi=(a,e)=>{$.ajax({type:"GET",data:{kode:a,id:e},dataType:"json",url:base_url+"bayar_hutang/get_detail_transaksi",success:function(a){a=a.header;$("#span_kode").text(a.kode),$("#span_tanggal").text(moment(a.tanggal).format("LL")),$("#span_kode_beli").text(a.kode_pembelian),$("#span_nilai").text("Rp. "+parseFloat(a.nilai_bayar).toLocaleString("id")),$("#span_petugas").text(a.nama_user),$("#span_keterangan").text(a.keterangan),$("#modal_detail").modal("show"),$("#modal_title").text("Detail Pembayaran Hutang")},error:function(a,e,t){Swal.fire("Terjadi Kesalahan ")}})},delete_transaksi=(e,t)=>{swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"bayar_hutang/delete_transaksi",type:"POST",dataType:"JSON",data:{kode:e,id:t},success:function(a){swalConfirm.fire("Berhasil Hapus Data !",a.pesan,"success"),table.ajax.reload()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})};function edit_penerimaan(a){window.location.href=base_url+"barang_masuk/add_penerimaan?reff="+a+"&update=true"}function editorder(a){window.location.href=base_url+"penjualan/add_order?order_id="+a+"&mode=edit"}function editinvoice(a){window.location.href=base_url+"penjualan/new_invoice?order_id="+a+"&mode=edit"}function cetak_invoice(a){window.location.href=base_url+"penjualan/cetak_invoice?order_id="+a}function simpanedit(){swalConfirmDelete.fire({title:"Perhatian",text:"Apakah Anda ingin Menyimpan Invoice ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!0}).then(a=>{a.value?window.location.href=base_url+"penjualan":a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reload_table(){table.ajax.reload(null,!1)}function formatRupiah(a,e){var t=a.replace(/[^,\d]/g,"").toString().split(","),n=t[0].length%3,i=t[0].substr(0,n),a=t[0].substr(n).match(/\d{3}/gi);return a&&(separator=n?".":"",i+=separator+a.join(".")),i=null!=t[1]?i+","+t[1]:i,null==e?i:i?e+". "+i:""}function readURL(a){var e;a.files&&a.files[0]?((e=new FileReader).onload=function(a){$("#div_preview_foto").css("display","block"),$("#preview_img").attr("src",a.target.result)},e.readAsDataURL(a.files[0])):($("#div_preview_foto").css("display","none"),$("#preview_img").attr("src",""))}function createAlert(a,e,t,n,i,r,s){var o=!1,l=["alert","animated","flipInX"];l.push("alert-"+n.toLowerCase()),i&&l.push("alert-dismissible");var n=$("<i />",{class:{info:"fa fa-info-circle",success:"fa fa-thumbs-up",warning:"fa fa-exclamation-triangle",danger:"fa ffa fa-exclamation-circle"}[n]}),d=$("<div />",{class:l.join(" ")});a&&(a=$("<h4 />",{html:a}).appendTo(d),o||(a.prepend(n),o=!0)),e&&(e=$("<strong />",{html:e}).appendTo(d),o||(e.prepend(n),o=!0)),t&&(t=$("<p />",{html:t}).appendTo(d),o||(t.prepend(n),o=!0)),i&&$("<span />",{class:"close","data-dismiss":"alert",html:"<i class='fa fa-times-circle'></i>"}).appendTo(d),$("#"+s).prepend(d),r&&setTimeout(function(){d.addClass("flipOutX"),setTimeout(function(){d.remove()},1e3)},5e3)}function ajax_send(a){window.location.href=base_url+"barang_masuk/add_penerimaan?reff="+a}function getTable(){var a=$("#id_pembelian").val(),e=$("#id_penerimaan").val();console.log(a),$.ajax({type:"POST",url:base_url+"barang_masuk/fetch",data:{id:a,idMasuk:e},success:function(a){$("#tbody").html(a),getTotal()}})}function getTotal(){let a=0;$("#tbody tr td input.kelas_htotal").each(function(){a+=parseFloat(this.value)}),$("td#total").html("Rp "+numberWithCommas(a))}function numberWithCommas(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function tes(a){var e="#qty_order_"+a,t="#harga_total_"+a,n="#harga_total_raw_"+a,i=$(e).val(),r=window.location.href,r=new URL(r).searchParams.get("reff");$.ajax({url:base_url+"barang_masuk/change_qty",type:"POST",dataType:"JSON",data:{id:a,qty:i,kodereff:r},success:function(a){$(e).val(a.qty),$(t).text(a.harga_total),$(n).val(a.harga_raw),getTotal()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}})}function hapus_trans_detail(e){swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?($(e).closest("tr").remove(),getTotal()):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}