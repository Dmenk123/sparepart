var save_method,table,id_pen;$(document).ready(function(){let a=new URL(window.location.href);bulanUri=a.searchParams.get("bulan"),tahunUri=a.searchParams.get("tahun"),kategoriUri=a.searchParams.get("kategori"),"add_penerimaan"==window.location.pathname.split("/")[4]&&(getTable(),getTotal()),$("input.numberinput").bind("keypress",function(a){return 8==a.which||0==a.which||!(a.which<48||57<a.which)||46==a.which}),table=$("#tabel_penerimaan").DataTable({responsive:!0,searchDelay:500,processing:!0,serverSide:!0,ajax:{url:base_url+"bayar_hutang/list_bayar_hutang",type:"POST",data:{tahun:tahunUri,bulan:bulanUri,kategori:kategoriUri}},columnDefs:[{targets:[-1],orderable:!1}]}),$("#id_barang").on("select2:select",function(a){a=a.params.data;$.ajax({type:"get",url:base_url+"pembelian/get_harga_barang",data:{id_barang:a.id},dataType:"json",success:function(a){$("#hsat").val(a.hpp)}})}),$("#kode_pembelian").on("select2:select",function(a){var e=a.params.data,a=String(parseFloat(e.title));$("#hutang_txt").val(formatRupiah(a)),$("#hutang").val(e.title)}),$(".modal").on("hidden.bs.modal",function(){}),$("#regForm").submit(function(a){a.preventDefault(),$("#btnSaveAdd").prop("disabled",!0),$("#btnSaveAdd").text("Menyimpan Data ....");var a=$("#regForm")[0],e=new FormData(a);swalConfirm.fire({title:"Perhatian",text:"Apakah Anda ingin Menerima Data ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!1}).then(a=>{a.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"barang_masuk/simpan_penerimaan_barang",data:e,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)swalConfirm.fire("Berhasil Menambah Data!",a.pesan,"success"),$("#regForm")[0].reset(),window.location.href=base_url+"barang_masuk";else{for(var e=0;e<a.inputerror.length;e++)"pegawai"!=a.inputerror[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSaveAdd").prop("disabled",!1),$("#btnSaveAdd").text("Simpan")}},error:function(a){console.log("ERROR : ",a),createAlert("Opps!","Terjadi Kesalahan","Coba Lagi nanti","danger",!0,!1,"pageMessages"),$("#btnSaveAdd").prop("disabled",!1),$("#btnSaveAdd").text("Simpan")}}):a.dismiss===Swal.DismissReason.cancel&&(swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error"),$("#btnSaveAdd").prop("disabled",!1),$("#btnSaveAdd").text("Simpan"))})})});const detail_penerimaan=(a,e)=>{$.ajax({type:"GET",data:{kode:a,id:e},dataType:"json",url:base_url+"barang_masuk/get_detail_penerimaan",success:function(a){var e=a.header;$("#span_kode_beli_det").text(e.kode_pembelian),$("#span_tgl_beli_det").text(moment(e.tanggal_beli).format("LL")),$("#span_agen_det").text(e.nama_perusahaan),$("#span_kode_masuk_det").text(e.kode_penerimaan),$("#span_petugas_det").text(e.nama_user),$("#tbl_konten_detail tbody").html(a.html_det),$("#modal_det_masuk").modal("show"),$("#modal_title").text("Detail Barang Masuk")},error:function(a,e,t){Swal.fire("Terjadi Kesalahan ")}})};function edit_penerimaan(a){window.location.href=base_url+"barang_masuk/add_penerimaan?reff="+a+"&update=true"}function editorder(a){window.location.href=base_url+"penjualan/add_order?order_id="+a+"&mode=edit"}function editinvoice(a){window.location.href=base_url+"penjualan/new_invoice?order_id="+a+"&mode=edit"}function cetak_invoice(a){window.location.href=base_url+"penjualan/cetak_invoice?order_id="+a}function simpanedit(){swalConfirmDelete.fire({title:"Perhatian",text:"Apakah Anda ingin Menyimpan Invoice ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!0}).then(a=>{a.value?window.location.href=base_url+"penjualan":a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reload_table(){table.ajax.reload(null,!1)}function saveNew(){const t=$("#loading-circle");var e=base_url+"bayar_hutang/save_new_transaksi",a=$("#form-user")[0],n=new FormData(a);$("#btnSave").prop("disabled",!0),$("#btnSave").text("Menyimpan Data"),swalConfirm.fire({title:"Perhatian",text:"Apakah Anda ingin Menambah Data ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!1}).then(a=>{a.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:e,data:n,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)createAlert("","Berhasil!",""+a.pesan,"success",!0,!0,"pageMessages"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan"),t.css("display","block"),setTimeout(function(){ajax_send(a.kode),t.css("display","none")},2e3);else{for(var e=0;e<a.inputerror.length;e++)"pegawai"!=a.inputerror[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}},error:function(a){console.log("ERROR : ",a),createAlert("Opps!","Terjadi Kesalahan","Coba Lagi nanti","danger",!0,!1,"pageMessages"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function delete_penerimaan(e,t){swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"barang_masuk/delete_penerimaan",type:"POST",dataType:"JSON",data:{kode:e,id:t},success:function(a){swalConfirm.fire("Berhasil Hapus Data !",a.pesan,"success"),table.ajax.reload()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function formatRupiah(a,e){var t=a.replace(/[^,\d]/g,"").toString().split(","),n=t[0].length%3,r=t[0].substr(0,n),a=t[0].substr(n).match(/\d{3}/gi);return a&&(separator=n?".":"",r+=separator+a.join(".")),r=null!=t[1]?r+","+t[1]:r,null==e?r:r?e+". "+r:""}function readURL(a){var e;a.files&&a.files[0]?((e=new FileReader).onload=function(a){$("#div_preview_foto").css("display","block"),$("#preview_img").attr("src",a.target.result)},e.readAsDataURL(a.files[0])):($("#div_preview_foto").css("display","none"),$("#preview_img").attr("src",""))}function createAlert(a,e,t,n,r,i,s){var o=!1,l=["alert","animated","flipInX"];l.push("alert-"+n.toLowerCase()),r&&l.push("alert-dismissible");var n=$("<i />",{class:{info:"fa fa-info-circle",success:"fa fa-thumbs-up",warning:"fa fa-exclamation-triangle",danger:"fa ffa fa-exclamation-circle"}[n]}),d=$("<div />",{class:l.join(" ")});a&&(a=$("<h4 />",{html:a}).appendTo(d),o||(a.prepend(n),o=!0)),e&&(e=$("<strong />",{html:e}).appendTo(d),o||(e.prepend(n),o=!0)),t&&(t=$("<p />",{html:t}).appendTo(d),o||(t.prepend(n),o=!0)),r&&$("<span />",{class:"close","data-dismiss":"alert",html:"<i class='fa fa-times-circle'></i>"}).appendTo(d),$("#"+s).prepend(d),i&&setTimeout(function(){d.addClass("flipOutX"),setTimeout(function(){d.remove()},1e3)},5e3)}function ajax_send(a){window.location.href=base_url+"barang_masuk/add_penerimaan?reff="+a}function getTable(){var a=$("#id_pembelian").val(),e=$("#id_penerimaan").val();console.log(a),$.ajax({type:"POST",url:base_url+"barang_masuk/fetch",data:{id:a,idMasuk:e},success:function(a){$("#tbody").html(a),getTotal()}})}function getTotal(){let a=0;$("#tbody tr td input.kelas_htotal").each(function(){a+=parseFloat(this.value)}),$("td#total").html("Rp "+numberWithCommas(a))}function numberWithCommas(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function tes(a){var e="#qty_order_"+a,t="#harga_total_"+a,n="#harga_total_raw_"+a,r=$(e).val(),i=window.location.href,i=new URL(i).searchParams.get("reff");$.ajax({url:base_url+"barang_masuk/change_qty",type:"POST",dataType:"JSON",data:{id:a,qty:r,kodereff:i},success:function(a){$(e).val(a.qty),$(t).text(a.harga_total),$(n).val(a.harga_raw),getTotal()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}})}function hapus_trans_detail(e){swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?($(e).closest("tr").remove(),getTotal()):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}