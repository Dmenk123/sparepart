var save_method,table,id_pen;function add_menu(){reset_modal_form(),save_method="add",$("#modal_agen_form").modal("show"),$("#modal_title").text("Tambah Master Agen")}function edit_pembelian(e){window.location.href=base_url+"pembelian/add_pembelian?kode_pembelian="+e+"&update=true"}function editorder(e){window.location.href=base_url+"penjualan/add_order?order_id="+e+"&mode=edit"}function editinvoice(e){window.location.href=base_url+"penjualan/new_invoice?order_id="+e+"&mode=edit"}function cetak_invoice(e){window.location.href=base_url+"penjualan/cetak_invoice?order_id="+e}function simpanedit(){swalConfirmDelete.fire({title:"Perhatian",text:"Apakah Anda ingin Menyimpan Pembelian ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!0}).then(e=>{e.value?window.location.href=base_url+"penjualan":e.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reload_table(){table.ajax.reload(null,!1)}function saveNewpembelian(){const t=$("#loading-circle");var a=base_url+"pembelian/save_new_pembelian",e=$("#form-user")[0],n=new FormData(e);$("#btnSave").prop("disabled",!0),$("#btnSave").text("Menyimpan Data"),swalConfirm.fire({title:"Perhatian",text:"Apakah Anda ingin Menambah Data ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!1}).then(e=>{e.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:a,data:n,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(e){if(e.status)createAlert("","Berhasil!",""+e.pesan,"success",!0,!0,"pageMessages"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan"),t.css("display","block"),setTimeout(function(){ajax_send(e.kode),t.css("display","none")},2e3);else{for(var a=0;a<e.inputerror.length;a++)"pegawai"!=e.inputerror[a]?($('[name="'+e.inputerror[a]+'"]').addClass("is-invalid"),$('[name="'+e.inputerror[a]+'"]').next().text(e.error_string[a]).addClass("invalid-feedback")):$('[name="'+e.inputerror[a]+'"]').next().next().text(e.error_string[a]).addClass("invalid-feedback-select");$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}},error:function(e){console.log("ERROR : ",e),createAlert("Opps!","Terjadi Kesalahan","Coba Lagi nanti","danger",!0,!1,"pageMessages"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}}):e.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function delete_pembelian(a){swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(e=>{e.value?$.ajax({url:base_url+"pembelian/delete_pembelian",type:"POST",dataType:"JSON",data:{id:a},success:function(e){swalConfirm.fire("Berhasil Hapus Data !",e.pesan,"success"),table.ajax.reload()},error:function(e,a,t){Swal.fire("Terjadi Kesalahan")}}):e.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reset_modal_form(){$("#form-user")[0].reset(),$(".append-opt").remove(),$("div.form-group").children().removeClass("is-invalid invalid-feedback"),$("span.help-block").text(""),$("#div_pass_lama").css("display","none"),$("#div_preview_foto").css("display","none"),$("#div_skip_password").css("display","none"),$("#label_foto").text("Pilih gambar yang akan diupload"),$("#username").attr("disabled",!1)}function readURL(e){var a;e.files&&e.files[0]?((a=new FileReader).onload=function(e){$("#div_preview_foto").css("display","block"),$("#preview_img").attr("src",e.target.result)},a.readAsDataURL(e.files[0])):($("#div_preview_foto").css("display","none"),$("#preview_img").attr("src",""))}function createAlert(e,a,t,n,i,r,s){var l=!1,o=["alert","animated","flipInX"];o.push("alert-"+n.toLowerCase()),i&&o.push("alert-dismissible");var n=$("<i />",{class:{info:"fa fa-info-circle",success:"fa fa-thumbs-up",warning:"fa fa-exclamation-triangle",danger:"fa ffa fa-exclamation-circle"}[n]}),d=$("<div />",{class:o.join(" ")});e&&(e=$("<h4 />",{html:e}).appendTo(d),l||(e.prepend(n),l=!0)),a&&(a=$("<strong />",{html:a}).appendTo(d),l||(a.prepend(n),l=!0)),t&&(t=$("<p />",{html:t}).appendTo(d),l||(t.prepend(n),l=!0)),i&&$("<span />",{class:"close","data-dismiss":"alert",html:"<i class='fa fa-times-circle'></i>"}).appendTo(d),$("#"+s).prepend(d),r&&setTimeout(function(){d.addClass("flipOutX"),setTimeout(function(){d.remove()},1e3)},5e3)}function ajax_send(e){window.location.href=base_url+"pembelian/add_pembelian?kode_pembelian="+e}function getTable(){var e=$("#id_pembelian").val();console.log(e),$.ajax({type:"POST",url:base_url+"pembelian/fetch",data:{id:e},success:function(e){$("#tbody").html(e)}})}function getTotal(){var e=$("#id_pembelian").val();console.log(e),$.ajax({type:"POST",url:base_url+"pembelian/total_pembelian",data:{id:e},dataType:"json",success:function(e){$("#total").html(e.total)}})}function hapus_trans_detail(a){swalConfirm.fire({title:"Apakah Anda Yakin ?",text:"ingin menghapus daftar order ini ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!0}).then(e=>{e.value?$.ajax({url:base_url+"pembelian/hapus_trans_detail",type:"POST",dataType:"JSON",data:{id:a},success:function(e){swalConfirm.fire("Berhasil !",e.pesan,"success"),getTable(),getTotal()},error:function(e,a,t){Swal.fire("Terjadi Kesalahan")}}):e.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function tes(e){var a=$("#qty_order_"+e).val();$.ajax({url:base_url+"pembelian/change_qty",type:"POST",dataType:"JSON",data:{id:e,qty:a},success:function(e){getTable(),getTotal()},error:function(e,a,t){Swal.fire("Terjadi Kesalahan")}})}$(document).ready(function(){let e=new URL(window.location.href);bulanUri=e.searchParams.get("bulan"),tahunUri=e.searchParams.get("tahun"),kategoriUri=e.searchParams.get("kategori"),"add_pembelian"==window.location.pathname.split("/")[4]&&(getTable(),getTotal()),$("#regForm").submit(function(e){e.preventDefault();e=$("#regForm").serialize();$.ajax({type:"POST",data:e,dataType:"json",url:base_url+"pembelian/save_pembelian",success:function(e){swalConfirm.fire("Berhasil Menambah Data!",e.pesan,"success"),$("#regForm")[0].reset(),$("#id_barang").val(null).trigger("change"),getTable(),getTotal()},error:function(e,a,t){Swal.fire("Terjadi Kesalahan ")}})}),$("input.numberinput").bind("keypress",function(e){return 8==e.which||0==e.which||!(e.which<48||57<e.which)||46==e.which}),table=$("#tabel_pembelian").DataTable({responsive:!0,searchDelay:500,processing:!0,serverSide:!0,ajax:{url:base_url+"pembelian/list_pembelian",type:"POST",data:{tahun:tahunUri,bulan:bulanUri,kategori:kategoriUri}},columnDefs:[{targets:[-1],orderable:!1}],createdRow:function(e,a,t){"Lunas"==a[6]&&$(e).addClass("highlight_row_success")}}),$("#id_barang").on("select2:select",function(e){e=e.params.data;$.ajax({type:"get",url:base_url+"pembelian/get_harga_barang",data:{id_barang:e.id},dataType:"json",success:function(e){$("#hsat").mask("000.000.000.000",{reverse:!0}).val(e.hpp).trigger("input")}})}),$(".modal").on("hidden.bs.modal",function(){reset_modal_form(),reset_modal_form_import()})});const detail_pembelian=(e,a)=>{$.ajax({type:"GET",data:{kode:e,id:a},dataType:"json",url:base_url+"pembelian/get_detail_pembelian",success:function(e){var a=e.header;$("#span_kode_beli_det").text(a.kode_pembelian),$("#span_tgl_beli_det").text(moment(a.tanggal).format("LL")),$("#span_agen_det").text(a.nama_perusahaan),$("#span_petugas_det").text(a.nama_user),$("#tbl_konten_detail tbody").html(e.html_det),$("#modal_det_beli").modal("show"),$("#modal_title").text("Detail Pembelian")},error:function(e,a,t){Swal.fire("Terjadi Kesalahan ")}})};