let save_method,table,id_pen,bulanUri,tahunUri,kategoriUri;$(document).ready(function(){let a=new URL(window.location.href);bulanUri=a.searchParams.get("bulan"),tahunUri=a.searchParams.get("tahun"),kategoriUri=a.searchParams.get("kategori"),"add_transaksi_det"==window.location.pathname.split("/")[4]&&getTable(),$("input.numberinput").bind("keypress",function(a){return 8==a.which||0==a.which||!(a.which<48||57<a.which)||46==a.which}),table=$("#tabel_transaksi").DataTable({responsive:!0,processing:!0,serverside:!0,ajax:{url:base_url+"retur_beli/list_data_tabel",type:"POST",data:{tahun:tahunUri,bulan:bulanUri,kategori:kategoriUri}},language:{decimal:",",thousands:"."},createdRow:function(a,e,t){"Potong Nota"==e[4]&&$(a).addClass("highlight_row_info")}}),$("#regForm").submit(function(a){a.preventDefault();a=$("#regForm").serialize();$.ajax({type:"POST",data:a,dataType:"json",url:base_url+"retur_beli/save_trans_detail",success:function(a){swalConfirm.fire("Berhasil Menambah Data!",a.pesan,"success"),$("#regForm")[0].reset(),$("#id_barang").val(null).trigger("change"),getTable()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}})})});const saveNewTransaksi=()=>{$("#loading-circle");var e=base_url+"retur_beli/add_new_transaksi",a=$("#form-user")[0],t=new FormData(a);$("#btnSave").prop("disabled",!0),$("#btnSave").text("Menyimpan Data"),swalConfirm.fire({title:"Perhatian",text:"Apakah Anda ingin Menambah Data ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!1}).then(a=>{a.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:e,data:t,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)toastr.success("Sukses Menambah Penjualan","Sukses"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan"),setTimeout(function(){ajax_send(a.kode)},1e3);else{for(var e=0;e<a.inputerror.length;e++)"pegawai"!=a.inputerror[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}},error:function(a){toastr.warning(a,"Peringatan"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})},ajax_send=a=>{window.location.href=base_url+"retur_beli/add_transaksi_det?kode="+a},gunakanDataPenerimaan=e=>{let t=$("#inputQty-"+e).val(),n=$("#inputIdStok-"+e).val(),r=$("#span-id-retur").text(),i=$("#span-kode-retur").text();swalConfirm.fire({title:"Gunakan Data ?",text:"Data digunakan untuk Retur Pembelian ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!1}).then(a=>{a.value?$.ajax({type:"POST",dataType:"JSON",url:base_url+"retur_beli/pakai_data",data:{id:e,id_stok:n,id_retur:r,qty:t,kode_retur:i},success:function(a){a.status?swalConfirm.fire("Berhasil !",a.pesan,"success"):swalConfirm.fire("Gagal !",a.pesan,"error"),getTable()},error:function(a,e,t){console.log(a,e,t),Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})},getSelectBarang=a=>{a=a.value;0==a?$("#id_barang").empty().append('<option value="0">-PILIH-</option>'):$.ajax({type:"get",url:base_url+"penjualan/get_option_barang",data:{id_gudang:a},dataType:"json",success:function(a){$("#id_barang").html(a.html)}})},getTable=()=>{var a=$("#span-id-retur").text();$.ajax({type:"POST",url:base_url+"retur_beli/fetch",data:{id:a},success:function(a){$("#tbody").html(a)}})};function hapus_trans_det(e){swalConfirmDelete.fire({title:"Apakah Anda Yakin ?",text:"ingin menghapus daftar Transaksi ini ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"retur_beli/hapus_trans_detail",type:"POST",dataType:"JSON",data:{id:e},success:function(a){swalConfirm.fire("Berhasil !",a.pesan,"success"),getTable()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}const detail_transaksi=(a,e)=>{$.ajax({type:"GET",data:{kode:a,id:e},dataType:"json",url:base_url+"retur_beli/get_detail_transaksi",success:function(a){var e=a.header;$("#span_kode_det").text(e.kode_retur),$("#span_tgl_det").text(moment(e.tanggal).format("LL")),$("#span_petugas_det").text(e.nama_user),$("#span_jenis_det").text(a.jenis),$("#span_supplier_det").text(e.nama_perusahaan),$("#tbl_konten_detail tbody").html(a.html_det),$("#modal_det_trans").modal("show"),$("#modal_title").text("Detail Retur Penerimaan Pembelian")},error:function(a,e,t){Swal.fire("Terjadi Kesalahan ")}})},delete_transaksi=(e,t)=>{swalConfirmDelete.fire({title:"Hapus Data ?",text:"Data Akan dihapus permanen ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya, Hapus Data !",cancelButtonText:"Tidak, Batalkan!",reverseButtons:!0}).then(a=>{a.value?$.ajax({url:base_url+"retur_beli/delete_transaksi",type:"POST",dataType:"JSON",data:{id:t,kode:e},success:function(a){swalConfirm.fire("Berhasil Hapus Data!",a.pesan,"success"),table.ajax.reload()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})};function add_menu(){reset_modal_form(),save_method="add",$("#modal_agen_form").modal("show"),$("#modal_title").text("Tambah Master Agen")}function edit_transaksi(a,e){window.location.href=base_url+"retur_beli/add_transaksi_det?index="+e+"&kode="+a+"&mode=edit"}function editorder(a){window.location.href=base_url+"penjualan/add_order?no_faktur="+a+"&mode=edit"}function editinvoice(a){window.location.href=base_url+"penjualan/new_invoice?no_faktur="+a+"&mode=edit"}function cetak_invoice(a){window.location.href=base_url+"penjualan/cetak_invoice?no_faktur="+a}function simpanedit(){swalConfirmDelete.fire({title:"Perhatian",text:"Apakah Anda ingin Menyimpan Invoice ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!0}).then(a=>{a.value?window.location.href=base_url+"penjualan":a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reload_table(){table.ajax.reload(null,!1)}function editDataPenjualan(){$("#loading-circle");var e=base_url+"penjualan/update_new_invoice",a=$("#form-user")[0],t=new FormData(a);$("#btnSave").prop("disabled",!0),$("#btnSave").text("Menyimpan Data"),swalConfirmDelete.fire({title:"Perhatian",text:"Apakah Anda ingin Mengupdate Data ini ?",type:"warning",showCancelButton:!0,confirmButtonText:"Ya !",cancelButtonText:"Tidak !",reverseButtons:!0}).then(a=>{a.value?$.ajax({type:"POST",enctype:"multipart/form-data",url:e,data:t,dataType:"JSON",processData:!1,contentType:!1,cache:!1,timeout:6e5,success:function(a){if(a.status)toastr.success(a.pesan,"Sukses"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan"),window.location.href=base_url+"penjualan";else{for(var e=0;e<a.inputerror.length;e++)"pegawai"!=a.inputerror[e]?($('[name="'+a.inputerror[e]+'"]').addClass("is-invalid"),$('[name="'+a.inputerror[e]+'"]').next().text(a.error_string[e]).addClass("invalid-feedback")):$('[name="'+a.inputerror[e]+'"]').next().next().text(a.error_string[e]).addClass("invalid-feedback-select");$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}},error:function(a){console.log("ERROR : ",a),toastr.error("ERROR : "+a,"Gagal"),$("#btnSave").prop("disabled",!1),$("#btnSave").text("Simpan")}}):a.dismiss===Swal.DismissReason.cancel&&swalConfirm.fire("Dibatalkan","Aksi Dibatalakan","error")})}function reset_modal_form(){$("#form-user")[0].reset(),$(".append-opt").remove(),$("div.form-group").children().removeClass("is-invalid invalid-feedback"),$("span.help-block").text(""),$("#div_pass_lama").css("display","none"),$("#div_preview_foto").css("display","none"),$("#div_skip_password").css("display","none"),$("#label_foto").text("Pilih gambar yang akan diupload"),$("#username").attr("disabled",!1)}function reset_modal_form_import(){$("#form_import_excel")[0].reset(),$("#label_file_excel").text("Pilih file excel yang akan diupload")}function import_excel(){$("#modal_import_excel").modal("show"),$("#modal_import_title").text("Import data user")}function import_data_excel(){var a=$("#form_import_excel")[0],a=new FormData(a);$("#btnSaveImport").prop("disabled",!0),$("#btnSaveImport").text("Import Data"),$.ajax({type:"POST",enctype:"multipart/form-data",url:base_url+"master_user/import_data_master",data:a,dataType:"JSON",processData:!1,contentType:!1,success:function(a){a.status?swal.fire("Sukses!!",a.pesan,"success"):swal.fire("Gagal!!",a.pesan,"error"),$("#btnSaveImport").prop("disabled",!1),$("#btnSaveImport").text("Simpan"),reset_modal_form_import(),$(".modal").modal("hide"),table.ajax.reload()},error:function(a){console.log("ERROR : ",a),$("#btnSaveImport").prop("disabled",!1),$("#btnSaveImport").text("Simpan"),reset_modal_form_import(),$(".modal").modal("hide"),table.ajax.reload()}})}function tes(a){var e=$("#qty_order_"+a).val();$.ajax({url:base_url+"penjualan/change_qty",type:"POST",dataType:"JSON",data:{id:a,qty:e},success:function(a){getTable()},error:function(a,e,t){Swal.fire("Terjadi Kesalahan")}})}